var b=Object.defineProperty;var v=(r,t,e)=>t in r?b(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var f=(r,t,e)=>(v(r,typeof t!="symbol"?t+"":t,e),e),g=(r,t,e)=>{if(!t.has(r))throw TypeError("Cannot "+e)};var u=(r,t,e)=>(g(r,t,"read from private field"),e?e.call(r):t.get(r)),w=(r,t,e)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,e)},y=(r,t,e,s)=>(g(r,t,"write to private field"),s?s.call(r,e):t.set(r,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function e(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(a){if(a.ep)return;a.ep=!0;const i=e(a);fetch(a.href,i)}})();const L=/:\w+/g;var c;const d=class d{constructor(t){w(this,c,void 0);y(this,c,t),this.addEvent()}navigate(t){history.pushState(null,"",`${d.BASE_URL}${t}`),this.renderPage()}addEvent(){window.addEventListener("popstate",()=>this.renderPage()),window.addEventListener("load",()=>this.renderPage()),document.addEventListener("DOMContentLoaded",()=>this.renderPage())}findMatchRoute(t){const e=t.replace(d.BASE_URL,"");console.log("relative:",e);for(const s in u(this,c)){const a=new RegExp(`^${s.replace(L,"(\\w+)")}$`),i=e.match(a);if(i)return{route:s,match:i}}return null}extractParams(t,e){const s=e.slice(1);return Array.from(t.matchAll(L)).map(i=>i[0].replace(":","")).reduce((i,n,o)=>(i[n]=s[o],i),{})}renderPage(){const t=window.location.pathname,e=this.findMatchRoute(t);if(e){const{route:s,match:a}=e,i=u(this,c)[s],n=this.extractParams(s,a),o=document.querySelector("#app");new i(o,n)}else console.log("error")}};c=new WeakMap,f(d,"BASE_URL","/js-spa-weather-app");let l=d;const E={API_URL:"https://api.openweathermap.org/data/2.5",commonParam:{appid:"a38bd3e48e5f49f53a16ea46f62a2e8d",units:"metric"},getCurrentWeather:async function(r){const t={...this.commonParam,q:r};return await(await fetch(`${this.API_URL}/weather?${new URLSearchParams(t)}`)).json()},getWeatherForecasts:async function(r){const t={...this.commonParam,q:r};return(await(await fetch(`${this.API_URL}/forecast?${new URLSearchParams(t)}`)).json()).list}};class m{constructor(t,e){this.$root=t,this.params=e}init(){}getTemplate(){}render(){}addEvent(){}}class $ extends m{constructor(t,e,s){super(t,e),this.props=s,this.init()}init(){this.render()}render(){this.$root.innerHTML=`
      <div class="d-flex align-items-center">
        <img src="http://openweathermap.org/img/w/${this.props.weatherData.weather[0].icon}.png" />
        <div class="d-flex flex-column justify-content-between gap-1">
          <p>
            <p class="fw-semibold">현재</p>
            <p>${this.props.weatherData.main.temp} °C</p>
          </p>
          <p>
            <p class="fw-semibold">최저/최고</p>
            <p>${this.props.weatherData.main.temp_min} °C / ${this.props.weatherData.main.temp_max} °C</p>
          </p>
        </div>
      </div>
    `}}function P(r){return new Date(r*1e3).toLocaleString()}class D extends m{constructor(t,e){super(t,e),this.weatherData=null,this.isLoading=!0,this.isError=!1,this.init()}async init(){this.render(),await this.fetchWeather(),this.render(),this.addEvent()}getTemplate(){return`
      <div class="weather_list_page d-grid gap-4 border" style="width: 350px">
        <a href="${l.BASE_URL}/weather/Seoul" style="color: inherit; text-decoration: none;"></a>
      </div>
    `}render(){if(this.$root.innerHTML=this.isLoading?"<p>Loading...</p>":this.isError?`
        <p>
          <p>에러가 발생했습니다!</p>
          <button class="retry_button">재시도 🔄</button>
        </p>
      `:this.getTemplate(),this.isLoading||this.isError)return;const t=document.querySelector(".weather_list_page a");new $(t,null,{weatherData:this.weatherData});const e=document.createElement("h2");e.setAttribute("class","display-2 fw-bold"),e.innerText="Seoul";const s=document.createElement("h3");s.setAttribute("class","display-6 fw-semibold"),s.innerText=P(this.weatherData.dt),t.prepend(s),t.prepend(e)}addEvent(){this.isError&&document.querySelector(".retry_button").addEventListener("click",async e=>{this.isLoading=!0,this.render(),await this.fetchWeather(),this.render()})}async fetchWeather(){try{const t=await E.getCurrentWeather("Seoul");this.weatherData=t}catch{this.isError=!0}finally{this.isLoading=!1}}}class A extends m{constructor(t,e){super(t,e),this.weatherDataList={},this.isLoading=!0,this.isError=!1,this.init()}async init(){this.render(),await this.fetchData(),this.render()}getTemplate(){return`
      <h1 class="display-2 fw-bold">⛅️ ${this.params.name} 기상예보</h1>
      <main></main>
    `}render(){if(this.$root.innerHTML=this.isLoading?"<p>Loading...</p>":this.isError?"<p>Error...!</p>":this.getTemplate(),this.isLoading||this.isError)return;const t=document.querySelector("main");t.setAttribute("class","d-grid gap-4"),t.setAttribute("style","width: 350px"),Object.entries(this.weatherDataList).map(([e,s])=>{const a=document.createElement("div"),i=document.createElement("h3");i.innerText=e,i.setAttribute("class","display-3 fw-semibold");const n=document.createElement("div");n.setAttribute("class","d-grid gap-4"),s.map(o=>{const h=document.createElement("div");h.setAttribute("class","border p-2"),new $(h,null,{weatherData:o});const p=document.createElement("h3");p.setAttribute("class","display-6 fw-semibold"),p.innerText=o.dt_txt.split(" ")[1].split(":").slice(0,2).join(":"),h.prepend(p),n.appendChild(h)}),a.appendChild(i),a.appendChild(n),t.appendChild(a)})}async fetchData(){try{const t=await E.getWeatherForecasts("Seoul"),e=this.groupWeatherDataByDate(t);this.weatherDataList=e}catch{this.isError=!0}finally{this.isLoading=!1}}groupWeatherDataByDate(t){return t.reduce((e,s)=>{const a=s.dt_txt.split(" ")[0];return e[a]||(e[a]=[]),e[a].push(s),e},{})}}const S={"/weather":D,"/weather/:name":A};new l(S);console.log("씨벌탱");
