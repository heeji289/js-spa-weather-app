var u=(s,t,e)=>{if(!t.has(s))throw TypeError("Cannot "+e)};var l=(s,t,e)=>(u(s,t,"read from private field"),e?e.call(s):t.get(s)),m=(s,t,e)=>{if(t.has(s))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(s):t.set(s,e)},f=(s,t,e,a)=>(u(s,t,"write to private field"),a?a.call(s,e):t.set(s,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function e(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(r){if(r.ep)return;r.ep=!0;const n=e(r);fetch(r.href,n)}})();const g=/:\w+/g;var c;class L{constructor(t){m(this,c,void 0);f(this,c,t),this.addEvent()}navigate(t){history.pushState(null,"",t),this.renderPage()}addEvent(){window.addEventListener("popstate",()=>this.renderPage()),window.addEventListener("load",()=>{console.log("Load!!"),this.renderPage()}),document.addEventListener("DOMContentLoaded",()=>this.renderPage())}findMatchRoute(t){for(const e in l(this,c)){const a=new RegExp(`^${e.replace(g,"(\\w+)")}$`),r=t.match(a);if(r)return{route:e,match:r}}return null}extractParams(t,e){const a=e.slice(1);return Array.from(t.matchAll(g)).map(n=>n[0].replace(":","")).reduce((n,i,o)=>(n[i]=a[o],n),{})}renderPage(){const t=window.location.pathname,e=this.findMatchRoute(t);if(e){const{route:a,match:r}=e,n=l(this,c)[a],i=this.extractParams(a,r),o=document.querySelector("#app");new n(o,i)}else console.log("error")}}c=new WeakMap;const w={API_URL:"https://api.openweathermap.org/data/2.5",commonParam:{appid:"a38bd3e48e5f49f53a16ea46f62a2e8d",units:"metric"},getCurrentWeather:async function(s){const t={...this.commonParam,q:s};return await(await fetch(`${this.API_URL}/weather?${new URLSearchParams(t)}`)).json()},getWeatherForecasts:async function(s){const t={...this.commonParam,q:s};return(await(await fetch(`${this.API_URL}/forecast?${new URLSearchParams(t)}`)).json()).list}};class p{constructor(t,e){this.$root=t,this.params=e}init(){}getTemplate(){}render(){}addEvent(){}}class y extends p{constructor(t,e,a){super(t,e),this.props=a,this.init()}init(){this.render()}render(){this.$root.innerHTML=`
      <div class="d-flex align-items-center">
        <img src="http://openweathermap.org/img/w/${this.props.weatherData.weather[0].icon}.png" />
        <div class="d-flex flex-column justify-content-between gap-1">
          <p>
            <p class="fw-semibold">현재</p>
            <p>${this.props.weatherData.main.temp} °C</p>
          </p>
          <p>
            <p class="fw-semibold">최저/최고</p>
            <p>${this.props.weatherData.main.temp_min} °C / ${this.props.weatherData.main.temp_max} °C</p>
          </p>
        </div>
      </div>
    `}}function E(s){return new Date(s*1e3).toLocaleString()}class b extends p{constructor(t,e){super(t,e),this.weatherData=null,this.isLoading=!0,this.isError=!1,this.init()}async init(){this.render(),await this.fetchWeather(),this.render(),this.addEvent()}getTemplate(){return`
      <div class="weather_list_page d-grid gap-4 border" style="width: 350px">
        <a href="/weather/Seoul" style="color: inherit; text-decoration: none;"></a>
      </div>
    `}render(){if(this.$root.innerHTML=this.isLoading?"<p>Loading...</p>":this.isError?`
        <p>
          <p>에러가 발생했습니다!</p>
          <button class="retry_button">재시도 🔄</button>
        </p>
      `:this.getTemplate(),this.isLoading||this.isError)return;const t=document.querySelector(".weather_list_page a");new y(t,null,{weatherData:this.weatherData});const e=document.createElement("h2");e.setAttribute("class","display-2 fw-bold"),e.innerText="Seoul";const a=document.createElement("h3");a.setAttribute("class","display-6 fw-semibold"),a.innerText=E(this.weatherData.dt),t.prepend(a),t.prepend(e)}addEvent(){this.isError&&document.querySelector(".retry_button").addEventListener("click",async e=>{this.isLoading=!0,this.render(),await this.fetchWeather(),this.render()})}async fetchWeather(){try{const t=await w.getCurrentWeather("Seoul");this.weatherData=t}catch{this.isError=!0}finally{this.isLoading=!1}}}class $ extends p{constructor(t,e){super(t,e),this.weatherDataList={},this.isLoading=!0,this.isError=!1,this.init()}async init(){this.render(),await this.fetchData(),this.render()}getTemplate(){return`
      <h1 class="display-2 fw-bold">⛅️ ${this.params.name} 기상예보</h1>
      <main></main>
    `}render(){if(this.$root.innerHTML=this.isLoading?"<p>Loading...</p>":this.isError?"<p>Error...!</p>":this.getTemplate(),this.isLoading||this.isError)return;const t=document.querySelector("main");t.setAttribute("class","d-grid gap-4"),t.setAttribute("style","width: 350px"),Object.entries(this.weatherDataList).map(([e,a])=>{const r=document.createElement("div"),n=document.createElement("h3");n.innerText=e,n.setAttribute("class","display-3 fw-semibold");const i=document.createElement("div");i.setAttribute("class","d-grid gap-4"),a.map(o=>{const d=document.createElement("div");d.setAttribute("class","border p-2"),new y(d,null,{weatherData:o});const h=document.createElement("h3");h.setAttribute("class","display-6 fw-semibold"),h.innerText=o.dt_txt.split(" ")[1].split(":").slice(0,2).join(":"),d.prepend(h),i.appendChild(d)}),r.appendChild(n),r.appendChild(i),t.appendChild(r)})}async fetchData(){try{const t=await w.getWeatherForecasts("Seoul"),e=this.groupWeatherDataByDate(t);this.weatherDataList=e}catch{this.isError=!0}finally{this.isLoading=!1}}groupWeatherDataByDate(t){return t.reduce((e,a)=>{const r=a.dt_txt.split(" ")[0];return e[r]||(e[r]=[]),e[r].push(a),e},{})}}const P={"/weather":b,"/weather/:name":$};new L(P);console.log("씨벌탱");
