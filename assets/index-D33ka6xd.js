var u=(a,t,e)=>{if(!t.has(a))throw TypeError("Cannot "+e)};var l=(a,t,e)=>(u(a,t,"read from private field"),e?e.call(a):t.get(a)),m=(a,t,e)=>{if(t.has(a))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(a):t.set(a,e)},f=(a,t,e,s)=>(u(a,t,"write to private field"),s?s.call(a,e):t.set(a,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function e(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=e(r);fetch(r.href,i)}})();const g=/:\w+/g;var c;class L{constructor(t){m(this,c,void 0);f(this,c,t),this.addEvent()}navigate(t){history.pushState(null,"",t),this.renderPage()}addEvent(){window.addEventListener("popstate",()=>this.renderPage()),window.addEventListener("load",()=>this.renderPage()),document.addEventListener("DOMContentLoaded",()=>this.renderPage())}findMatchRoute(t){for(const e in l(this,c)){const s=new RegExp(`^${e.replace(g,"(\\w+)")}$`),r=t.match(s);if(r)return{route:e,match:r}}return null}extractParams(t,e){const s=e.slice(1);return Array.from(t.matchAll(g)).map(i=>i[0].replace(":","")).reduce((i,n,o)=>(i[n]=s[o],i),{})}renderPage(){const t=window.location.pathname,e=this.findMatchRoute(t);if(e){const{route:s,match:r}=e,i=l(this,c)[s],n=this.extractParams(s,r),o=document.querySelector("#app");new i(o,n)}}}c=new WeakMap;const w={API_URL:"https://api.openweathermap.org/data/2.5",commonParam:{appid:"a38bd3e48e5f49f53a16ea46f62a2e8d",units:"metric"},getCurrentWeather:async function(a){const t={...this.commonParam,q:a};return await(await fetch(`${this.API_URL}/weather?${new URLSearchParams(t)}`)).json()},getWeatherForecasts:async function(a){const t={...this.commonParam,q:a};return(await(await fetch(`${this.API_URL}/forecast?${new URLSearchParams(t)}`)).json()).list}};class p{constructor(t,e){this.$root=t,this.params=e}init(){}getTemplate(){}render(){}addEvent(){}}class y extends p{constructor(t,e,s){super(t,e),this.props=s,this.init()}init(){this.render()}render(){this.$root.innerHTML=`
      <div class="d-flex align-items-center">
        <img src="http://openweathermap.org/img/w/${this.props.weatherData.weather[0].icon}.png" />
        <div class="d-flex flex-column justify-content-between gap-1">
          <p>
            <p class="fw-semibold">현재</p>
            <p>${this.props.weatherData.main.temp} °C</p>
          </p>
          <p>
            <p class="fw-semibold">최저/최고</p>
            <p>${this.props.weatherData.main.temp_min} °C / ${this.props.weatherData.main.temp_max} °C</p>
          </p>
        </div>
      </div>
    `}}function E(a){return new Date(a*1e3).toLocaleString()}class b extends p{constructor(t,e){super(t,e),this.weatherData=null,this.isLoading=!0,this.isError=!1,this.init()}async init(){this.render(),await this.fetchWeather(),this.render(),this.addEvent()}getTemplate(){return`
      <div class="weather_list_page d-grid gap-4 border" style="width: 350px">
        <a href="/weather/Seoul" style="color: inherit; text-decoration: none;"></a>
      </div>
    `}render(){if(this.$root.innerHTML=this.isLoading?"<p>Loading...</p>":this.isError?`
        <p>
          <p>에러가 발생했습니다!</p>
          <button class="retry_button">재시도 🔄</button>
        </p>
      `:this.getTemplate(),this.isLoading||this.isError)return;const t=document.querySelector(".weather_list_page a");new y(t,null,{weatherData:this.weatherData});const e=document.createElement("h2");e.setAttribute("class","display-2 fw-bold"),e.innerText="Seoul";const s=document.createElement("h3");s.setAttribute("class","display-6 fw-semibold"),s.innerText=E(this.weatherData.dt),t.prepend(s),t.prepend(e)}addEvent(){this.isError&&document.querySelector(".retry_button").addEventListener("click",async e=>{this.isLoading=!0,this.render(),await this.fetchWeather(),this.render()})}async fetchWeather(){try{const t=await w.getCurrentWeather("Seoul");this.weatherData=t}catch{this.isError=!0}finally{this.isLoading=!1}}}class $ extends p{constructor(t,e){super(t,e),this.weatherDataList={},this.isLoading=!0,this.isError=!1,this.init()}async init(){this.render(),await this.fetchData(),this.render()}getTemplate(){return`
      <h1 class="display-2 fw-bold">⛅️ ${this.params.name} 기상예보</h1>
      <main></main>
    `}render(){if(this.$root.innerHTML=this.isLoading?"<p>Loading...</p>":this.isError?"<p>Error...!</p>":this.getTemplate(),this.isLoading||this.isError)return;const t=document.querySelector("main");t.setAttribute("class","d-grid gap-4"),t.setAttribute("style","width: 350px"),Object.entries(this.weatherDataList).map(([e,s])=>{const r=document.createElement("div"),i=document.createElement("h3");i.innerText=e,i.setAttribute("class","display-3 fw-semibold");const n=document.createElement("div");n.setAttribute("class","d-grid gap-4"),s.map(o=>{const d=document.createElement("div");d.setAttribute("class","border p-2"),new y(d,null,{weatherData:o});const h=document.createElement("h3");h.setAttribute("class","display-6 fw-semibold"),h.innerText=o.dt_txt.split(" ")[1].split(":").slice(0,2).join(":"),d.prepend(h),n.appendChild(d)}),r.appendChild(i),r.appendChild(n),t.appendChild(r)})}async fetchData(){try{const t=await w.getWeatherForecasts("Seoul"),e=this.groupWeatherDataByDate(t);this.weatherDataList=e}catch{this.isError=!0}finally{this.isLoading=!1}}groupWeatherDataByDate(t){return t.reduce((e,s)=>{const r=s.dt_txt.split(" ")[0];return e[r]||(e[r]=[]),e[r].push(s),e},{})}}const P={"/weather":b,"/weather/:name":$};new L(P);
